/* File generated by shrinker.ch - DateTime: 2012-03-13, 09:14:02 */
var minesweeper={size:8,locked:false,mine:{count:0,position:[],cleared:[]},init:function(b){this.size=b>=8?b:8;this.dom={};this.dom.board=$("#ms-board");this.dom.mode=$("#ms-mode");this.dom.create=$("#ms-create");this.dom.cheat=$("#ms-cheat");this.dom.validate=$("#ms-validate");this.dom.save=$("#ms-save");this.dom.load=$("#ms-load");$.cookie("minesweeper_size")||this.dom.load.attr("disabled","disabled");this.dom.board.on("lock",null,this,function(a){a.data.dom.cheat.attr("disabled","disabled");a.data.dom.validate.attr("disabled",
"disabled");a.data.dom.save.attr("disabled","disabled");a.data.locked=true});this.dom.board.on("unlock",null,this,function(a){a.data.dom.cheat.removeAttr("disabled");a.data.dom.validate.removeAttr("disabled");a.data.dom.save.attr("disabled","disabled");a.data.locked=false});this.dom.create.on("click",null,this,function(a){a.data.create()});this.dom.validate.on("click",null,this,function(a){if(!a.data.locked){for(var c in a.data.mine.cleared)if(!$(a.data.dom.square[a.data.mine.cleared[c]-1]).hasClass("cleared")){confirm("GAME OVER !!!\n\nYou failed to clear the game board.\n\nNew Game ?")?
a.data.create():a.data.dom.board.trigger("lock");return false}confirm("CONGRATULATIONS !!!\n\nYou have successfully cleared the game board.\n\nNew Game ?")?a.data.create():a.data.dom.board.trigger("lock");return false}return true});this.dom.cheat.on("click",null,this,function(a){if(!a.data.locked){for(var c in a.data.mine.position)$(a.data.dom.square[a.data.mine.position[c]-1]).toggleClass("exploded");$(this).text($(this).text()=="Cheat"?"Play":"Cheat")}});this.dom.save.on("click",null,this,function(a){if(!a.data.locked){var c=
[];$(".ms-board-square.cleared").each(function(){c.push($(this).attr("for"))});$.cookie("minesweeper_size",a.data.size,{expires:31,path:"/minesweeper"});$.cookie("minesweeper_selected",c,{expires:31,path:"/minesweeper"});$.cookie("minesweeper_position",a.data.mine.position,{expires:31,path:"/minesweeper"});$.cookie("minesweeper_cleared",a.data.mine.cleared,{expires:31,path:"/minesweeper"});a.data.dom.save.attr("disabled","disabled");a.data.dom.load.removeAttr("disabled")}});this.dom.load.on("click",
null,this,function(a){a.data.create($.cookie("minesweeper_size"));a.data.mine.cleared=$.cookie("minesweeper_cleared").split(",").map(function(e){return parseInt(e)});a.data.mine.position=$.cookie("minesweeper_position").split(",").map(function(e){return parseInt(e)});a.data.mine.count=a.data.mine.position.length;var c=$.cookie("minesweeper_selected").split(",").map(function(e){return parseInt(e)}),f;for(f in c)$(a.data.dom.square[c[f]-1]).addClass("cleared").text(a.data.scan(c[f])||"")});this.dom.mode.val(this.size);
this.create();return this},create:function(b){var a=1,c=undefined,f=undefined,e=undefined;this.dom.board.trigger("unlock");if(typeof b!="undefined"){this.size=parseInt(b);this.dom.mode.val(this.size)}else this.size=parseInt(this.dom.mode.val());this.dom.cheat.text("Cheat");this.dom.board.empty();for(c=0;c<this.size;c++)for(f=0;f<this.size;f++){e=$('<span for="'+a++ +'" class="ms-board-square"></span>');c>0&&f==0&&e.addClass("row");this.dom.board.append(e)}this.dom.square=$(".ms-board-square");this.dom.square.on("click",
null,this,function(d){if(!d.data.locked&&!$(this).hasClass("flagged")&&!$(this).hasClass("cleared")&&!$(this).hasClass("exploded")){$(this).addClass("cleared");d.data.dom.save.removeAttr("disabled");if(d.data.armed(parseInt($(this).attr("for")))){for(var g in d.data.mine.position)$(d.data.dom.square[d.data.mine.position[g]-1]).toggleClass("exploded");confirm("GAME OVER !!!\n\nNew Game ?")?d.data.create():d.data.dom.board.trigger("lock")}else{g=d.data.scan(parseInt($(this).attr("for")));$(this).text(g||
"");g||d.data.clear(parseInt($(this).attr("for")))}}}).on("contextmenu",null,this,function(d){!d.data.locked&&!$(this).hasClass("cleared")&&$(this).toggleClass("flagged");return false});this.arm()},arm:function(){this.mine.count=Math.floor(this.size/8*this.size/8*10);this.mine.position=[];this.mine.cleared=[];for(var b=1;b<=this.size*this.size;b++)this.mine.cleared.push(b);for(b=1;b<=this.mine.count;b++)this.mine.position.push(this.mine.cleared.splice(Math.floor(Math.random()*this.mine.cleared.length),
1)[0])},clear:function(b){var a=this.grid(b);a.col>1&&this.check(b-1);a.col<this.size&&this.check(b+1);if(a.row>1){this.check(b-this.size);a.col>1&&this.check(b-this.size-1);a.col<this.size&&this.check(b-this.size+1)}if(a.row<this.size){this.check(b+this.size);a.col>1&&this.check(b+this.size-1);a.col<this.size&&this.check(b+this.size+1)}},check:function(b){var a=this.scan(b);$(this.dom.square[b-1]).text(a||"");a?$(this.dom.square[b-1]).addClass("cleared"):$(this.dom.square[b-1]).click()},scan:function(b){var a=
this.grid(b),c=0;a.col>1&&this.armed(b-1)&&c++;a.col<this.size&&this.armed(b+1)&&c++;if(a.row>1){this.armed(b-this.size)&&c++;a.col>1&&this.armed(b-this.size-1)&&c++;a.col<this.size&&this.armed(b-this.size+1)&&c++}if(a.row<this.size){this.armed(b+this.size)&&c++;a.col>1&&this.armed(b+this.size-1)&&c++;a.col<this.size&&this.armed(b+this.size+1)&&c++}return c},grid:function(b){var a=Math.floor(b/this.size);b=(b/this.size-a++)*this.size;if(!b){b=this.size;--a}return{row:a,col:b}},armed:function(b){return this.mine.position.indexOf(b)!=
-1?true:false}};$(document).ready(function(){window.Minesweeper=minesweeper.init(8)});
